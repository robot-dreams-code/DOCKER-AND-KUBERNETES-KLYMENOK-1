

# searching for Dragonfly Operator Helm repo 
PS C:\Users\username\Documents\repos\DOCKER-AND-KUBERNETES-KLYMENOK-1\homeworks\krotov\module-03\lesson-12\k8s> ls
PS C:\Users\username\Documents\repos\DOCKER-AND-KUBERNETES-KLYMENOK-1\homeworks\krotov\module-03\lesson-12\k8s> helm search repo dragonfly
NAME                            CHART VERSION   APP VERSION     DESCRIPTION
dragonfly/dragonfly             1.5.7           2.3.4           Dragonfly is an intelligent P2P based image and...
dragonfly/dragonfly-stack       0.1.2           2.1.49          Collects Dragonfly component and Nydus componen...
dragonfly/nydus-snapshotter     0.0.10          0.9.0           Nydus snapshotter is an external plugin of cont...



# no Dragonfly Operator option is found, so I googled a little and find out that Dragonfly Operator have its own repo:
# https://github.com/dragonflydb/dragonfly-operator
# and proceeded with installation as described there
PS C:\Users\username\Documents\repos\DOCKER-AND-KUBERNETES-KLYMENOK-1\homeworks\krotov\module-03\lesson-12\k8s> kubectl apply -f https://raw.githubusercontent.com/dragonflydb/dragonfly-operator/main/manifests/dragonfly-operator.yaml
namespace/dragonfly-operator-system created
customresourcedefinition.apiextensions.k8s.io/dragonflies.dragonflydb.io created
serviceaccount/dragonfly-operator-controller-manager created
role.rbac.authorization.k8s.io/dragonfly-operator-leader-election-role created
clusterrole.rbac.authorization.k8s.io/dragonfly-operator-manager-role created
clusterrole.rbac.authorization.k8s.io/dragonfly-operator-metrics-reader created
clusterrole.rbac.authorization.k8s.io/dragonfly-operator-proxy-role created
rolebinding.rbac.authorization.k8s.io/dragonfly-operator-leader-election-rolebinding created
clusterrolebinding.rbac.authorization.k8s.io/dragonfly-operator-manager-rolebinding created
clusterrolebinding.rbac.authorization.k8s.io/dragonfly-operator-proxy-rolebinding created
service/dragonfly-operator-controller-manager-metrics-service created
deployment.apps/dragonfly-operator-controller-manager created 

# installation done, verification of newly created api-resources
PS C:\Users\username\Documents\repos\DOCKER-AND-KUBERNETES-KLYMENOK-1\homeworks\krotov\module-03\lesson-12\k8s> kubectl api-resources | Select-String "dragonfly"
NAME                                SHORTNAMES   APIVERSION                          NAMESPACED   KIND
dragonflies                                      dragonflydb.io/v1alpha1             true         Dragonfly

# checking for available and mandatory fields for dragonfly.spec
# skipped some output, only command execution and first values shown 
PS C:\Users\username\Documents\repos\DOCKER-AND-KUBERNETES-KLYMENOK-1\homeworks\krotov\module-03\lesson-12\k8s> kubectl explain dragonfly.spec
GROUP:      dragonflydb.io
KIND:       Dragonfly
VERSION:    v1alpha1

FIELD: spec <Object>


DESCRIPTION:
    DragonflySpec defines the desired state of Dragonfly

FIELDS:



  additionalVolumes     <[]Object>
    (Optional) Additional volumes to add to dragonflycluster. Replace volume on
    name collision.

  affinity      <Object>
    (Optional) Dragonfly pod affinity

  annotations   <map[string]string>
    (Optional) Annotations to add to the Dragonfly pods.
    ......
    ......
    ......
    ......


# deploying python-app after applying changes to Helm config files
# APP_STORE and APP_REDIS_URL variables configured to work with new Dragonfly instance 
PS C:\Users\username\Documents\repos\DOCKER-AND-KUBERNETES-KLYMENOK-1\homeworks\krotov\module-03\lesson-12\k8s\helm> helm install python-app-lesson12 . -n krotovhh
NAME: python-app-lesson12
LAST DEPLOYED: Sat Dec 13 21:52:17 2025
NAMESPACE: krotovhh
STATUS: deployed
REVISION: 1
DESCRIPTION: Install complete
TEST SUITE: None

# checking for vars in pod to verfiy pythonapp using new Dragonfly instance as storage
PS C:\Users\username\Documents\repos\DOCKER-AND-KUBERNETES-KLYMENOK-1\homeworks\krotov\module-03\lesson-12\k8s\helm> kubectl exec -n krotovhh -it python-course-app-lesson12-deployment-6bc67ccb5-hhfz8 -- /bin/bash
root@python-course-app-lesson12-deployment-6bc67ccb5-hhfz8:/app# printenv | grep APP_REDIS
APP_REDIS_URL=redis://dragonfly-lesson12:6379


# checking can-i's for db-viewer service account 
PS C:\Users\username\Documents\repos\DOCKER-AND-KUBERNETES-KLYMENOK-1\homeworks\krotov\module-03\lesson-12\k8s> kubectl auth can-i get dragonflies --as=system:serviceaccount:krotovhh:db-viewer -n krotovhh
yes
PS C:\Users\username\Documents\repos\DOCKER-AND-KUBERNETES-KLYMENOK-1\homeworks\krotov\module-03\lesson-12\k8s> kubectl auth can-i list dragonflies --as=system:serviceaccount:krotovhh:db-viewer -n krotovhh
yes
PS C:\Users\username\Documents\repos\DOCKER-AND-KUBERNETES-KLYMENOK-1\homeworks\krotov\module-03\lesson-12\k8s> kubectl auth can-i delete dragonflies --as=system:serviceaccount:krotovhh:db-viewer -n krotovhh
no





